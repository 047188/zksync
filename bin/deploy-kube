#!/bin/bash

. .setup_env prod
. .confirm_action

# Configure cluster
kubectl --kubeconfig etc/kube/kubeconfig.yaml apply -f etc/kube/franklin.yaml

# Generate and apply secrets configuration from prod env
. .kube_gen_secret | kubectl apply -f -

# Restart deployments (this will re-pull images)
kubectl patch deployment server -p "{\"spec\":{\"template\":{\"metadata\":{\"labels\":{\"date\":\"$(date +%s)\"}}}}}"
kubectl patch deployment prover -p "{\"spec\":{\"template\":{\"metadata\":{\"labels\":{\"date\":\"$(date +%s)\"}}}}}"
