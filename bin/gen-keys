#!/bin/bash

set -e

. .setup_env

# HACK: We need to rebuild sources in case hardcoded values changed that might affect the keys
touch core/models/src/lib.rs

OUTPUT_DIR=$ZKSYNC_HOME/$KEY_DIR/account-$ACCOUNT_TREE_DEPTH/

for BLOCK_SIZE in $(echo $BLOCK_CHUNK_SIZES | sed "s/,/ /g"); do
    mkdir -p $OUTPUT_DIR/block-$BLOCK_SIZE
done

mkdir -p "$OUTPUT_DIR/exodus_key"
cargo run --bin key_generator --release -- block
cargo run --bin key_generator --release -- exodus_key
cargo run --bin key_generator --release -- contract

cp $OUTPUT_DIR/VerificationKey.sol $ZKSYNC_HOME/contracts/contracts
